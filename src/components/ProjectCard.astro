---
import type { ImageMetadata } from 'astro';

import Button from './ui/Button.astro';
import { Image } from 'astro:assets';

interface Props {
    projectImage: string;
    smallImage: string;
    content: string;
    name: string;
    link?: string;
    class?: string;
    [x: string]: any;
}

const {
    projectImage,
    smallImage,
    content,
    name,
    class: className,
    link,
    ...rest
} = Astro.props;

const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/projects/*.{jpeg,jpg,png,gif}');
if (!images[projectImage]) throw new Error(`"${projectImage}" does not exist in glob: "src/assets/projects/*.{jpeg,jpg,png,gif}"`);
if (!images[smallImage]) throw new Error(`"${projectImage}" does not exist in glob: "src/assets/projects/*.{jpeg,jpg,png,gif}"`);
---

<div {...rest} class="flex flex-col justify-between bg-quaternary rounded-2xl overflow-hidden relative w-full h-auto md:h-[540px] lg:h-[470px] mb-8 shadow-xl">
    <div class="w-full p-8 h-1/2 lg:h-full lg:w-1/2">
        <h3 class="mb-2 font-serif text-xl">{name}</h3>
        <p class="text-base" set:html={content}></p>
        <Button class="" link={link} style="tertiary" color="dark">Discover more about {name}</Button>
    </div>
    <div class="relative bottom-0 right-0 inline-flex flex-col items-start justify-start w-full overflow-hidden mask-project lg:w-3/4 h-1/2 lg:h-full md:absolute">
      <Image src={images[projectImage]()} class="aspect-[790/470] min-w-full h-auto lg:w-auto lg:min-h-full" loading="lazy" width={790} height={470} alt={name}/>
      {smallImage && <Image loading="eager" src={images[smallImage]()}  class="absolute w-10 h-auto md:w-20 top-4 right-4 md:top-8 md:right-8" width={56} height={56} alt={name} /> }
    </div> 
</div>

<style>
    .mask-project {
        clip-path: polygon( 54.806% 0.062%,54.806% 0.062%,53.272% 0.408%,51.853% 1.125%,50.559% 2.116%,49.402% 3.286%,48.392% 4.539%,47.541% 5.779%,46.86% 6.911%,46.36% 7.837%,46.052% 8.464%,45.947% 8.694%,-0.036% 100%,99.927% 99.938%,99.927% 99.938%,99.934% 99.938%,99.942% 99.938%,99.949% 99.938%,99.956% 99.938%,99.964% 99.938%,99.971% 99.938%,99.978% 99.938%,99.985% 99.938%,99.993% 99.938%,100% 99.938%,100% 0.041%,54.806% 0.041% );
        mask-size: cover; 
        mask-size: 200% auto;
        mask-position: top right;
    }
    
    @media only screen and (min-width: 768px) {
        .mask-project {
            mask-size: cover; 
            mask-position: unset;
        }
    }
</style>