---
import { getCollection } from 'astro:content';
import { i18nParams } from '../../../i18n/consts'
import Base from '@layouts/Base.astro';
import HeroHeader from '@components/HeroHeader.astro';
import Button from '@components/ui/Button.astro';
import { useTranslations } from 'src/i18n/utils';

import { Image } from 'astro:assets';

const { lang } = Astro.params;

const cases = (await getCollection('cases'));

export function getStaticPaths() {
  return i18nParams;
}

function getPostLangAndSlug(post) {
	const [lang, ...slug] = post.slug.split('/');
	return {lang, slug}
}

const t = useTranslations(lang, 'work');

---
<Base title={t('work.title')}>
	<HeroHeader 
		headline={t('hero.headline')}
		text={t('hero.subheadline')}
	/>

	<div class="relative flex flex-col mb-40 xl:flex-row py-20 gap-8 before:-z-10 before:bg-light-blue-50 before:absolute before:-left-[3000px] before:top-0 before:bottom-0 before:right-[1000px] marker:before:h-full before:w-[10000px] before:rounded-xl">
		<div class="flex flex-col items-start w-full gap-2 mb-16 xl:sticky xl:w-4/12 h-fit top-40">
		  <h2 class="mb-2 font-serif text-2xl" set:html={t('overview.headline')}></h2>
		</div>
		<div class="flex flex-col w-full gap-2 xl:w-8/12">
			{
				cases.map((casepost) => (
					getPostLangAndSlug(casepost).lang === lang &&
						<div class="flex flex-col justify-between bg-quaternary rounded-2xl overflow-hidden relative w-full h-auto mb-8 shadow-xl">
						<div class="w-full p-8 h-1/2 ">
							<h3 class="mb-2 font-serif text-xl" set:html={casepost.data.title}></h3>
							<p class="text-base" set:html={casepost.data.description}></p>
							<Button class="" link={`/cases/${getPostLangAndSlug(casepost).slug}/`} style="tertiary" color="dark">
								{t('overview.cta') + " " + casepost.data.title}
							</Button>
						</div>
						<div class="relative bottom-0 right-0 inline-flex flex-col items-start justify-start w-full overflow-hidden mask-project  h-1/2">
							<Image loading="lazy" src={casepost.data.heroImage} class="aspect-[790/470] min-w-full h-auto lg:w-auto lg:min-h-full" loading="lazy" width={790} height={470} alt={casepost.data.title}/>
						</div> 
					</div>
				))
			}
		</div>
	</div>
</Base>